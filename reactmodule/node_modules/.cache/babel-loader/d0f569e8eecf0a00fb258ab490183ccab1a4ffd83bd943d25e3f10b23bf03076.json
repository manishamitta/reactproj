{"ast":null,"code":"import { enrichEventWithDetails } from '@ui5/webcomponents-react-base';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport const VirtualTableBodyContainer = props => {\n  const {\n    tableBodyHeight,\n    totalColumnsWidth,\n    children,\n    parentRef,\n    classes,\n    infiniteScroll,\n    infiniteScrollThreshold,\n    onLoadMore,\n    rows,\n    internalRowHeight,\n    handleExternalScroll,\n    visibleRows,\n    popInRowHeight,\n    rowCollapsedFlag,\n    dispatch\n  } = props;\n  const [isMounted, setIsMounted] = useState(false);\n  useEffect(() => {\n    if (parentRef.current) {\n      setIsMounted(true);\n    }\n  }, [parentRef.current]);\n  const dataLength = rows.length;\n  const lastScrollTop = useRef(0);\n  const firedInfiniteLoadEvents = useRef(new Set());\n  const prevDataLength = useRef(dataLength);\n  useEffect(() => {\n    if (prevDataLength.current > dataLength) {\n      // if prevData is larger because a row was collapsed, no scroll should be executed\n      if (rowCollapsedFlag) {\n        dispatch({\n          type: 'ROW_COLLAPSED_FLAG',\n          payload: false\n        });\n      } else {\n        firedInfiniteLoadEvents.current.clear();\n        parentRef.current.scrollTop = 0;\n        lastScrollTop.current = 0;\n      }\n    }\n    prevDataLength.current = dataLength;\n  }, [dataLength, rowCollapsedFlag]);\n  const onScroll = useCallback(event => {\n    handleExternalScroll(enrichEventWithDetails(event, {\n      rows,\n      rowElements: event.target.children[0].children\n    }));\n    const scrollOffset = event.target.scrollTop;\n    const isScrollingDown = lastScrollTop.current < scrollOffset;\n    if (isScrollingDown && infiniteScroll) {\n      lastScrollTop.current = scrollOffset;\n      const currentLastRow = Math.floor(scrollOffset / popInRowHeight) + (popInRowHeight === internalRowHeight ? visibleRows : Math.floor(tableBodyHeight / popInRowHeight));\n      if (rows.length - currentLastRow < infiniteScrollThreshold) {\n        if (!firedInfiniteLoadEvents.current.has(rows.length)) {\n          onLoadMore(event);\n        }\n        firedInfiniteLoadEvents.current.add(rows.length);\n      }\n    }\n  }, [infiniteScroll, infiniteScrollThreshold, onLoadMore, rows, internalRowHeight, firedInfiniteLoadEvents, lastScrollTop, handleExternalScroll, popInRowHeight, tableBodyHeight]);\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: classes.tbody,\n    ref: parentRef,\n    onScroll: onScroll,\n    style: {\n      position: 'relative',\n      overflowY: 'auto',\n      height: `${tableBodyHeight}px`,\n      width: `${totalColumnsWidth}px`\n    },\n    \"data-component-name\": \"AnalyticalTableBody\",\n    children: isMounted && children\n  });\n};","map":{"version":3,"names":["enrichEventWithDetails","useCallback","useEffect","useRef","useState","jsx","_jsx","VirtualTableBodyContainer","props","tableBodyHeight","totalColumnsWidth","children","parentRef","classes","infiniteScroll","infiniteScrollThreshold","onLoadMore","rows","internalRowHeight","handleExternalScroll","visibleRows","popInRowHeight","rowCollapsedFlag","dispatch","isMounted","setIsMounted","current","dataLength","length","lastScrollTop","firedInfiniteLoadEvents","Set","prevDataLength","type","payload","clear","scrollTop","onScroll","event","rowElements","target","scrollOffset","isScrollingDown","currentLastRow","Math","floor","has","add","className","tbody","ref","style","position","overflowY","height","width"],"sources":["/home/user/projects/reactproj/node_modules/@ui5/webcomponents-react/dist/components/AnalyticalTable/TableBody/VirtualTableBodyContainer.js"],"sourcesContent":["import { enrichEventWithDetails } from '@ui5/webcomponents-react-base';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport const VirtualTableBodyContainer = props => {\n  const {\n    tableBodyHeight,\n    totalColumnsWidth,\n    children,\n    parentRef,\n    classes,\n    infiniteScroll,\n    infiniteScrollThreshold,\n    onLoadMore,\n    rows,\n    internalRowHeight,\n    handleExternalScroll,\n    visibleRows,\n    popInRowHeight,\n    rowCollapsedFlag,\n    dispatch\n  } = props;\n  const [isMounted, setIsMounted] = useState(false);\n  useEffect(() => {\n    if (parentRef.current) {\n      setIsMounted(true);\n    }\n  }, [parentRef.current]);\n  const dataLength = rows.length;\n  const lastScrollTop = useRef(0);\n  const firedInfiniteLoadEvents = useRef(new Set());\n  const prevDataLength = useRef(dataLength);\n  useEffect(() => {\n    if (prevDataLength.current > dataLength) {\n      // if prevData is larger because a row was collapsed, no scroll should be executed\n      if (rowCollapsedFlag) {\n        dispatch({\n          type: 'ROW_COLLAPSED_FLAG',\n          payload: false\n        });\n      } else {\n        firedInfiniteLoadEvents.current.clear();\n        parentRef.current.scrollTop = 0;\n        lastScrollTop.current = 0;\n      }\n    }\n    prevDataLength.current = dataLength;\n  }, [dataLength, rowCollapsedFlag]);\n  const onScroll = useCallback(event => {\n    handleExternalScroll(enrichEventWithDetails(event, {\n      rows,\n      rowElements: event.target.children[0].children\n    }));\n    const scrollOffset = event.target.scrollTop;\n    const isScrollingDown = lastScrollTop.current < scrollOffset;\n    if (isScrollingDown && infiniteScroll) {\n      lastScrollTop.current = scrollOffset;\n      const currentLastRow = Math.floor(scrollOffset / popInRowHeight) + (popInRowHeight === internalRowHeight ? visibleRows : Math.floor(tableBodyHeight / popInRowHeight));\n      if (rows.length - currentLastRow < infiniteScrollThreshold) {\n        if (!firedInfiniteLoadEvents.current.has(rows.length)) {\n          onLoadMore(event);\n        }\n        firedInfiniteLoadEvents.current.add(rows.length);\n      }\n    }\n  }, [infiniteScroll, infiniteScrollThreshold, onLoadMore, rows, internalRowHeight, firedInfiniteLoadEvents, lastScrollTop, handleExternalScroll, popInRowHeight, tableBodyHeight]);\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: classes.tbody,\n    ref: parentRef,\n    onScroll: onScroll,\n    style: {\n      position: 'relative',\n      overflowY: 'auto',\n      height: `${tableBodyHeight}px`,\n      width: `${totalColumnsWidth}px`\n    },\n    \"data-component-name\": \"AnalyticalTableBody\",\n    children: isMounted && children\n  });\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}