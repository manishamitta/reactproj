{"ast":null,"code":"\"use strict\";\n\nimport g from \"./EventProvider.js\";\nimport v from \"./RenderQueue.js\";\nimport { getAllRegisteredTags as A } from \"./CustomElementsRegistry.js\";\nimport { isRtlAware as R } from \"./locale/RTLAwareRegistry.js\";\nconst s = new Set(),\n  d = new g(),\n  n = new v();\nlet t, a, m, i;\nconst l = async e => {\n    n.add(e), await P();\n  },\n  c = e => {\n    d.fireEvent(\"beforeComponentRender\", e), s.add(e), e._render();\n  },\n  h = e => {\n    n.remove(e), s.delete(e);\n  },\n  P = async () => {\n    i || (i = new Promise(e => {\n      window.requestAnimationFrame(() => {\n        n.process(c), i = null, e(), m || (m = setTimeout(() => {\n          m = void 0, n.isEmpty() && U();\n        }, 200));\n      });\n    })), await i;\n  },\n  y = () => t || (t = new Promise(e => {\n    a = e, window.requestAnimationFrame(() => {\n      n.isEmpty() && (t = void 0, e());\n    });\n  }), t),\n  I = () => {\n    const e = A().map(r => customElements.whenDefined(r));\n    return Promise.all(e);\n  },\n  f = async () => {\n    await I(), await y();\n  },\n  U = () => {\n    n.isEmpty() && a && (a(), a = void 0, t = void 0);\n  },\n  C = async e => {\n    s.forEach(r => {\n      const o = r.constructor,\n        u = o.getMetadata().getTag(),\n        w = R(o),\n        p = o.getMetadata().isLanguageAware(),\n        E = o.getMetadata().isThemeAware();\n      (!e || e.tag === u || e.rtlAware && w || e.languageAware && p || e.themeAware && E) && l(r);\n    }), await f();\n  },\n  T = e => {\n    d.attachEvent(\"beforeComponentRender\", e);\n  },\n  b = e => {\n    d.detachEvent(\"beforeComponentRender\", e);\n  };\nexport { l as renderDeferred, c as renderImmediately, h as cancelRender, f as renderFinished, C as reRenderAllUI5Elements, T as attachBeforeComponentRender, b as detachBeforeComponentRender };","map":{"version":3,"names":["g","v","getAllRegisteredTags","A","isRtlAware","R","s","Set","d","n","t","a","m","i","l","e","add","P","c","fireEvent","_render","h","remove","delete","scheduleRenderTask","Promise","window","requestAnimationFrame","process","setTimeout","isEmpty","U","y","whenDOMUpdated","I","whenAllCustomElementsAreDefined","map","r","customElements","whenDefined","all","f","renderFinished","_resolveTaskPromise","C","forEach","o","constructor","u","getMetadata","getTag","w","p","isLanguageAware","E","isThemeAware","tag","rtlAware","languageAware","themeAware","T","attachEvent","b","detachEvent","renderDeferred","renderImmediately","cancelRender","reRenderAllUI5Elements","attachBeforeComponentRender","detachBeforeComponentRender"],"sources":["/home/user/projects/reactproj/node_modules/@ui5/webcomponents-base/src/Render.ts"],"sourcesContent":["import EventProvider from \"./EventProvider.js\";\nimport RenderQueue from \"./RenderQueue.js\";\nimport { getAllRegisteredTags } from \"./CustomElementsRegistry.js\";\nimport { isRtlAware } from \"./locale/RTLAwareRegistry.js\";\nimport type UI5Element from \"./UI5Element.js\";\nimport type { PromiseResolve, Timeout } from \"./types.js\";\n\ntype BeforeComponentRenderCallback = (webComponent: UI5Element) => void;\n\nconst registeredElements = new Set<UI5Element>();\nconst eventProvider = new EventProvider<UI5Element, void>();\n\nconst invalidatedWebComponents = new RenderQueue(); // Queue for invalidated web components\n\nlet renderTaskPromise: Promise<void> | undefined,\n\trenderTaskPromiseResolve: PromiseResolve | undefined;\n\nlet mutationObserverTimer: Timeout | undefined;\n\nlet queuePromise: Promise<void> | null;\n\n/**\n * Schedules a render task (if not already scheduled) to render the component\n *\n * @param webComponent\n * @returns {Promise}\n */\nconst renderDeferred = async (webComponent: UI5Element) => {\n\t// Enqueue the web component\n\tinvalidatedWebComponents.add(webComponent);\n\n\t// Schedule a rendering task\n\tawait scheduleRenderTask();\n};\n\n/**\n * Renders a component synchronously and adds it to the registry of rendered components\n *\n * @param webComponent\n */\nconst renderImmediately = (webComponent: UI5Element) => {\n\teventProvider.fireEvent(\"beforeComponentRender\", webComponent);\n\tregisteredElements.add(webComponent);\n\twebComponent._render();\n};\n\n/**\n * Cancels the rendering of a component, if awaiting to be rendered, and removes it from the registry of rendered components\n *\n * @param webComponent\n */\nconst cancelRender = (webComponent: UI5Element) => {\n\tinvalidatedWebComponents.remove(webComponent);\n\tregisteredElements.delete(webComponent);\n};\n\n/**\n * Schedules a rendering task, if not scheduled already\n */\nconst scheduleRenderTask = async () => {\n\tif (!queuePromise) {\n\t\tqueuePromise = new Promise<void>(resolve => {\n\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\t// Render all components in the queue\n\n\t\t\t\t// console.log(`--------------------RENDER TASK START------------------------------`); // eslint-disable-line\n\t\t\t\tinvalidatedWebComponents.process(renderImmediately);\n\t\t\t\t// console.log(`--------------------RENDER TASK END------------------------------`); // eslint-disable-line\n\n\t\t\t\t// Resolve the promise so that callers of renderDeferred can continue\n\t\t\t\tqueuePromise = null;\n\t\t\t\tresolve();\n\n\t\t\t\t// Wait for Mutation observer before the render task is considered finished\n\t\t\t\tif (!mutationObserverTimer) {\n\t\t\t\t\tmutationObserverTimer = setTimeout(() => {\n\t\t\t\t\t\tmutationObserverTimer = undefined;\n\t\t\t\t\t\tif (invalidatedWebComponents.isEmpty()) {\n\t\t\t\t\t\t\t_resolveTaskPromise();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 200);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tawait queuePromise;\n};\n\n/**\n * return a promise that will be resolved once all invalidated web components are rendered\n */\nconst whenDOMUpdated = () => {\n\tif (renderTaskPromise) {\n\t\treturn renderTaskPromise;\n\t}\n\n\trenderTaskPromise = new Promise<void>(resolve => {\n\t\trenderTaskPromiseResolve = resolve;\n\t\twindow.requestAnimationFrame(() => {\n\t\t\tif (invalidatedWebComponents.isEmpty()) {\n\t\t\t\trenderTaskPromise = undefined;\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n\n\treturn renderTaskPromise;\n};\n\nconst whenAllCustomElementsAreDefined = () => {\n\tconst definedPromises = getAllRegisteredTags().map(tag => customElements.whenDefined(tag));\n\treturn Promise.all(definedPromises);\n};\n\nconst renderFinished = async () => {\n\tawait whenAllCustomElementsAreDefined();\n\tawait whenDOMUpdated();\n};\n\nconst _resolveTaskPromise = () => {\n\tif (!invalidatedWebComponents.isEmpty()) {\n\t\t// More updates are pending. Resolve will be called again\n\t\treturn;\n\t}\n\n\tif (renderTaskPromiseResolve) {\n\t\trenderTaskPromiseResolve();\n\t\trenderTaskPromiseResolve = undefined;\n\t\trenderTaskPromise = undefined;\n\t}\n};\n\n/**\n * Re-renders all UI5 Elements on the page, with the option to specify filters to rerender only some components.\n *\n * Usage:\n * reRenderAllUI5Elements() -> re-renders all components\n * reRenderAllUI5Elements({tag: \"ui5-button\"}) -> re-renders only instances of ui5-button\n * reRenderAllUI5Elements({rtlAware: true}) -> re-renders only rtlAware components\n * reRenderAllUI5Elements({languageAware: true}) -> re-renders only languageAware components\n * reRenderAllUI5Elements({themeAware: true}) -> re-renders only themeAware components\n * reRenderAllUI5Elements({rtlAware: true, languageAware: true}) -> re-renders components that are rtlAware or languageAware\n * etc...\n *\n * @public\n * @param {object|undefined} filters - Object with keys that can be \"rtlAware\" or \"languageAware\"\n * @returns {Promise<void>}\n */\nconst reRenderAllUI5Elements = async (filters?: {tag?: string, rtlAware?: boolean, languageAware?: boolean, themeAware?: boolean}) => {\n\tregisteredElements.forEach((element: UI5Element) => {\n\t\tconst ctor = element.constructor as typeof UI5Element;\n\t\tconst tag = ctor.getMetadata().getTag();\n\t\tconst rtlAware = isRtlAware(ctor);\n\t\tconst languageAware = ctor.getMetadata().isLanguageAware();\n\t\tconst themeAware = ctor.getMetadata().isThemeAware();\n\t\tif (!filters || (filters.tag === tag) || (filters.rtlAware && rtlAware) || (filters.languageAware && languageAware) || (filters.themeAware && themeAware)) {\n\t\t\trenderDeferred(element);\n\t\t}\n\t});\n\tawait renderFinished();\n};\n\nconst attachBeforeComponentRender = (listener: BeforeComponentRenderCallback) => {\n\teventProvider.attachEvent(\"beforeComponentRender\", listener);\n};\n\nconst detachBeforeComponentRender = (listener: BeforeComponentRenderCallback) => {\n\teventProvider.detachEvent(\"beforeComponentRender\", listener);\n};\n\nexport {\n\trenderDeferred,\n\trenderImmediately,\n\tcancelRender,\n\trenderFinished,\n\treRenderAllUI5Elements,\n\tattachBeforeComponentRender,\n\tdetachBeforeComponentRender,\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}